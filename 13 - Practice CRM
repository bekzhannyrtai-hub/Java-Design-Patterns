@Component
public class ClientController {
    private final ClientRepository clientRepository;
    
    @Autowired
    public ClientController(ClientRepository clientRepository) {
        this.clientRepository = clientRepository;
    }
    
    public Client addClient(Client client) {
        return clientRepository.save(client);
    }
    
    public List<Client> getAllClients() {
        return clientRepository.findAll();
    }
    
    public Client updateClient(Long id, Client updatedClient) {
        Client client = clientRepository.findById(id)
            .orElseThrow(() -> new ClientNotFoundException(id));
        client.setName(updatedClient.getName());
        client.setEmail(updatedClient.getEmail());
        client.setPhone(updatedClient.getPhone());
        return clientRepository.save(client);
    }
    
    public void deleteClient(Long id) {
        clientRepository.deleteById(id);
    }
}

@Component
public class TaskController {
    private final TaskRepository taskRepository;
    
    public Task createTask(Task task) {
        task.setStatus(TaskStatus.PENDING);
        task.setCreatedDate(LocalDateTime.now());
        return taskRepository.save(task);
    }
    
    public Task completeTask(Long taskId) {
        Task task = taskRepository.findById(taskId)
            .orElseThrow(() -> new TaskNotFoundException(taskId));
        task.setStatus(TaskStatus.COMPLETED);
        task.setCompletedDate(LocalDateTime.now());
        return taskRepository.save(task);
    }
    
    public List<Task> getTasksByClient(Long clientId) {
        return taskRepository.findByClientId(clientId);
    }
    
    public List<Task> getTasksByStatus(TaskStatus status) {
        return taskRepository.findByStatus(status);
    }
}

@Component
public class ReportController {
    private final ClientRepository clientRepository;
    private final TaskRepository taskRepository;
    
    public Report generateClientReport() {
        Report report = new Report();
        report.setGeneratedDate(LocalDateTime.now());
        report.setTotalClients(clientRepository.count());
        report.setActiveClients(clientRepository.countActiveClients());
        
        List<Client> topClients = clientRepository.findTopClientsByTasks(10);
        report.setTopClients(topClients);
        
        return report;
    }
    
    public Report generateTaskReport(LocalDate from, LocalDate to) {
        Report report = new Report();
        report.setGeneratedDate(LocalDateTime.now());
        
        long completedTasks = taskRepository.countCompletedTasksBetween(from, to);
        long pendingTasks = taskRepository.countPendingTasks();
        
        report.setCompletedTasks(completedTasks);
        report.setPendingTasks(pendingTasks);
        report.setCompletionRate(calculateCompletionRate(completedTasks, pendingTasks));
        
        return report;
    }
}

@Entity
public class Client {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;
    private String email;
    private String phone;
    private LocalDate registrationDate;
    private boolean active;
    
    @OneToMany(mappedBy = "client", cascade = CascadeType.ALL)
    private List<Task> tasks;
}

@Entity
public class Task {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String title;
    private String description;
    
    @Enumerated(EnumType.STRING)
    private TaskStatus status;
    
    private LocalDateTime createdDate;
    private LocalDateTime completedDate;
    
    @ManyToOne
    @JoinColumn(name = "client_id")
    private Client client;
}

public enum TaskStatus {
    PENDING, IN_PROGRESS, COMPLETED, CANCELLED
}
