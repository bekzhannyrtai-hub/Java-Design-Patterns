```mermaid
sequenceDiagram
    actor Пользователь
    participant Система
    participant Склад
    participant ПлатежныйШлюз

    Пользователь->>Система: Вход в систему
    Пользователь->>Система: Добавить товары в корзину
    Пользователь->>Система: Подтвердить заказ
    
    Система->>Склад: Проверить доступность товаров
    Склад-->>Система: Ответ о наличии
    
    alt Все товары доступны
        Система-->>Пользователь: Заказ подтвержден
        Пользователь->>Система: Выбрать способ оплаты
        
        alt Онлайн-платеж
            Система->>ПлатежныйШлюз: Запрос на обработку платежа
            ПлатежныйШлюз-->>Система: Результат оплаты
            
            alt Платеж успешен
                Система-->>Пользователь: Подтверждение заказа
                Система->>Склад: Уведомление о сборке заказа
            else Платеж не прошел
                Система-->>Пользователь: Ошибка оплаты
            end
        else Оплата при доставке
            Система-->>Пользователь: Заказ оформлен
            Система->>Склад: Уведомление о сборке заказа
        end
    else Товары недоступны
        Система-->>Пользователь: Предложить изменить корзину
    end
